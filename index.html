<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Äá»’ ÃN Tá»T NGHIá»†P Sá»šM Cá»¦A ANH CU TÃ‚N ğŸ˜</title>
<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-family:Arial,sans-serif;
    background:url('anhnen.jpg') no-repeat center center;
    background-size:cover;
}
canvas{border:2px solid black;}
#startButton{padding:10px 20px;font-size:18px;cursor:pointer;}
#score{font-size:22px;margin:5px;}
#countdown{font-size:48px;color:blue;display:none;}
#gameOver{font-size:24px;color:red;display:none;}
</style>
</head>

<body>

<h2 style="color:darkblue;">Äá»’ ÃN Tá»T NGHIá»†P Sá»šM Cá»¦A ANH CU TÃ‚N ğŸ˜</h2>
<button id="startButton">Báº¯t Ä‘áº§u</button>
<div id="countdown"></div>
<div id="score">Äiá»ƒm: 0 | Ká»‰ lá»¥c: 0</div>
<div id="gameOver">NHáº¤N SPACE Äá»‚ CHÆ I Láº I ÄI THáº°NG NGU áº !ğŸ¤¬</div>

<canvas id="gameCanvas" width="1200" height="300"></canvas>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");

const startButton=document.getElementById("startButton");
const scoreDiv=document.getElementById("score");
const countdownDiv=document.getElementById("countdown");
const gameOverDiv=document.getElementById("gameOver");

// ===== IMAGES =====
const groundImg=new Image(); groundImg.src="dat.jpg";
const dinoImg=new Image(); dinoImg.src="khunglong.jpg";
const cactusImg=new Image(); cactusImg.src="xuongrong.jpg";
const birdImg=new Image(); birdImg.src="chim.jpg";

// ===== SOUNDS =====
const jumpSound=new Audio("jump.mp3");
const gameOverSound=new Audio("gameover.mp3");
const newRecordSound=new Audio("newrecord.mp3");

// ===== VARIABLES =====
let bgX=0;
let dino={x:50,y:220,width:40,height:40,dy:0,jumping:false,ducked:false};
let obstacles=[];
let score=0;
let gameRunning=false;
let gameOver=false;

let gravity=0.8;
let jumpStrength=-14;
let obstacleSpeed=5;

let highScore=localStorage.getItem("highScore")||0;
let recordPlayed=false;

// ===== GAP CONTROL =====
const MIN_GAP=180;
const MAX_GAP=380;
function randomGap(){
    return MIN_GAP+Math.random()*(MAX_GAP-MIN_GAP);
}
let nextObstacleGap=randomGap();

// ===== DRAW =====
function drawBackground(){
    ctx.drawImage(groundImg,-bgX,0,canvas.width,canvas.height);
    ctx.drawImage(groundImg,canvas.width-bgX,0,canvas.width,canvas.height);
    bgX+=1;
    if(bgX>=canvas.width) bgX=0;
}
function drawDino(){
    let h=dino.ducked?20:dino.height;
    let y=dino.ducked?dino.y+20:dino.y;
    ctx.drawImage(dinoImg,dino.x,y,dino.width*1.5,h*1.5);
}
function drawObstacles(){
    obstacles.forEach(o=>{
        if(o.type==="cactus")
            ctx.drawImage(cactusImg,o.x,o.y,o.width*1.5,o.height*1.5);
        else
            ctx.drawImage(birdImg,o.x,o.y,o.width,o.height);
    });
}

// ===== UPDATE =====
function updateDino(){
    if(dino.jumping){
        dino.dy+=gravity;
        dino.y+=dino.dy;
        if(dino.y>=220){
            dino.y=220;
            dino.dy=0;
            dino.jumping=false;
        }
    }
}

// ===== SPAWN CACTUS (80% ÄÆ N â€“ 20% ÄÃ”I) =====
function spawnCactus(){
    const isDouble=Math.random()<0.2;

    obstacles.push({type:"cactus",x:canvas.width,y:220,width:20,height:40});

    if(isDouble){
        obstacles.push({type:"cactus",x:canvas.width+35,y:220,width:20,height:40});
    }

    nextObstacleGap=randomGap();
}

// ===== SPAWN BIRD (60% KHÃ“) =====
function spawnBird(){
    let y;
    if(Math.random()<0.6){
        y=Math.random()<0.5?200:170; // pháº£i cÃºi hoáº·c nháº£y
    }else{
        y=130+Math.random()*20; // dá»…
    }

    obstacles.push({type:"bird",x:canvas.width,y:y,width:30,height:20});
    nextObstacleGap=randomGap();
}

// ===== UPDATE OBSTACLES =====
function updateObstacles(){
    obstacles.forEach(o=>o.x-=obstacleSpeed);
    obstacles=obstacles.filter(o=>o.x>-o.width);

    if(obstacles.length===0){
        spawnCactus();
        return;
    }

    let last=obstacles[obstacles.length-1];
    if(canvas.width-last.x>=nextObstacleGap){
        if(score<5000){
            spawnCactus();
        }else{
            Math.random()<0.25?spawnBird():spawnCactus();
        }
    }
}

// ===== COLLISION =====
function checkCollision(){
    obstacles.forEach(o=>{
        let h=dino.ducked?20:dino.height;
        let y=dino.ducked?dino.y+20:dino.y;
        if(dino.x<o.x+o.width&&dino.x+dino.width>o.x&&y<o.y+o.height&&y+h>o.y){
            gameRunning=false;
            gameOver=true;
            gameOverSound.currentTime=0;
            gameOverSound.play();
            gameOverDiv.style.display="block";
        }
    });
}

// ===== GAME LOOP =====
function gameLoop(){
    if(!gameRunning) return;
    drawBackground();
    drawDino();
    drawObstacles();
    updateDino();
    updateObstacles();
    checkCollision();

    score+=1.5;

    if(score>highScore){
        highScore=Math.floor(score);
        localStorage.setItem("highScore",highScore);
        if(!recordPlayed){
            newRecordSound.currentTime=0;
            newRecordSound.play();
            recordPlayed=true;
        }
    }

    scoreDiv.textContent=`Äiá»ƒm: ${Math.floor(score)} | Ká»‰ lá»¥c: ${highScore}`;
    requestAnimationFrame(gameLoop);
}

// ===== COUNTDOWN =====
function startCountdown(){
    let c=3;
    countdownDiv.style.display="block";
    countdownDiv.textContent=c;
    const t=setInterval(()=>{
        c--;
        if(c>0) countdownDiv.textContent=c;
        else{
            clearInterval(t);
            countdownDiv.style.display="none";
            gameRunning=true;
            gameLoop();
        }
    },1000);
}

// ===== RESET =====
function resetGame(){
    obstacles=[];
    score=0;
    recordPlayed=false;
    dino.y=220; dino.dy=0; dino.jumping=false; dino.ducked=false;
    gameOver=false;
    gameOverDiv.style.display="none";
    startCountdown();
}

// ===== EVENTS =====
startButton.onclick=()=>{
    startButton.style.display="none";
    resetGame();
};

document.addEventListener("keydown",e=>{
    if(e.code==="Space"){
        e.preventDefault();
        if(gameRunning&&!dino.jumping&&!dino.ducked){
            dino.jumping=true;
            dino.dy=jumpStrength;
            jumpSound.currentTime=0;
            jumpSound.play();
        }else if(gameOver){
            resetGame();
        }
    }
    if(e.code==="ArrowDown"&&gameRunning&&!dino.jumping) dino.ducked=true;
});
document.addEventListener("keyup",e=>{
    if(e.code==="ArrowDown") dino.ducked=false;
});
</script>
</body>
</html>
