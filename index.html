<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Äá»’ ÃN Tá»T NGHIá»†P Sá»šM Cá»¦A ANH CU TÃ‚N ğŸ˜</title>
<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:url('anhnen.jpg') no-repeat center center;
    background-size:cover;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
}
canvas{
    border:2px solid black;
    display:block;
}
#startButton{
    padding:10px 20px;font-size:18px;cursor:pointer;margin-bottom:5px;
}
#score{font-size:22px;margin:5px;}
#countdown{font-size:48px;color:blue;display:none;}
#gameOver{font-size:24px;color:red;display:none;}
#touchControls{
    display:flex;
    justify-content:space-around;
    width:100%;
    max-width:600px;
    margin-top:10px;
}
.touchBtn{
    width:45%;
    padding:15px;
    font-size:20px;
    background:rgba(0,0,0,0.3);
    color:white;
    border-radius:10px;
    text-align:center;
    user-select:none;
}
#rotateNotice{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.8);
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    text-align:center;
    z-index:100;
    display:none;
}
</style>
</head>
<body>

<h2 style="color:darkblue;">Äá»’ ÃN Tá»T NGHIá»†P Sá»šM Cá»¦A ANH CU TÃ‚N ğŸ˜</h2>
<button id="startButton">Báº¯t Ä‘áº§u</button>
<div id="countdown"></div>
<div id="score">Äiá»ƒm: 0 | Ká»‰ lá»¥c: 0</div>
<div id="gameOver">NHáº¤N SPACE Äá»‚ CHÆ I Láº I ÄI THáº°NG NGU áº !ğŸ¤¬</div>

<canvas id="gameCanvas"></canvas>

<div id="touchControls">
    <div id="jumpBtn" class="touchBtn">JUMP</div>
    <div id="duckBtn" class="touchBtn">DUCK</div>
</div>

<div id="rotateNotice">Vui lÃ²ng xoay ngang mÃ n hÃ¬nh Ä‘á»ƒ chÆ¡i!</div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const startButton=document.getElementById("startButton");
const scoreDiv=document.getElementById("score");
const countdownDiv=document.getElementById("countdown");
const gameOverDiv=document.getElementById("gameOver");
const rotateNotice=document.getElementById("rotateNotice");

const jumpBtn=document.getElementById("jumpBtn");
const duckBtn=document.getElementById("duckBtn");

// ===== IMAGES =====
const groundImg=new Image(); groundImg.src="dat.jpg";
const dinoImg=new Image(); dinoImg.src="khunglong.jpg";
const cactusImg=new Image(); cactusImg.src="xuongrong.jpg";
const birdImg=new Image(); birdImg.src="chim.jpg";

// ===== SOUNDS =====
const jumpSound=new Audio("jump.mp3");
const gameOverSound=new Audio("gameover.mp3");
const newRecordSound=new Audio("newrecord.mp3");

// ===== VARIABLES =====
let bgX=0;
let dino={x:50,y:220,width:40,height:40,dy:0,jumping:false,ducked:false};
let obstacles=[];
let score=0;
let gameRunning=false;
let gameOver=false;

let gravity=0.8;
let jumpStrength=-14;
let obstacleSpeed=5;

let highScore=localStorage.getItem("highScore")||0;
let recordPlayed=false;

// ===== GAP CONTROL =====
const MIN_GAP=180;
const MAX_GAP=380;
function randomGap(){ return MIN_GAP+Math.random()*(MAX_GAP-MIN_GAP); }
let nextObstacleGap=randomGap();

// ===== RESIZE CANVAS =====
function resizeCanvas(){
    if(window.innerWidth>window.innerHeight){
        canvas.width = window.innerWidth*0.95;
        canvas.height = window.innerHeight*0.4;
        rotateNotice.style.display="none";
    }else{
        rotateNotice.style.display="flex";
    }
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ===== DRAW FUNCTIONS =====
function drawBackground(){
    ctx.drawImage(groundImg,-bgX,0,canvas.width,canvas.height);
    ctx.drawImage(groundImg,canvas.width-bgX,0,canvas.width,canvas.height);
    bgX+=1;
    if(bgX>=canvas.width) bgX=0;
}
function drawDino(){
    let h=dino.ducked?20:dino.height;
    let y=dino.ducked?dino.y+20:dino.y;
    ctx.drawImage(dinoImg,dino.x,y,dino.width*1.5,h*1.5);
}
function drawObstacles(){
    obstacles.forEach(o=>{
        if(o.type==="cactus")
            ctx.drawImage(cactusImg,o.x,o.y,o.width*1.5,o.height*1.5);
        else
            ctx.drawImage(birdImg,o.x,o.y,o.width,o.height);
    });
}

// ===== UPDATE FUNCTIONS =====
function updateDino(){
    if(dino.jumping){
        dino.dy+=gravity;
        dino.y+=dino.dy;
        if(dino.y>=220){
            dino.y=220;
            dino.dy=0;
            dino.jumping=false;
        }
    }
}
function spawnCactus(){
    const isDouble=Math.random()<0.2;
    obstacles.push({type:"cactus",x:canvas.width,y:220,width:20,height:40});
    if(isDouble){
        obstacles.push({type:"cactus",x:canvas.width+35,y:220,width:20,height:40});
    }
    nextObstacleGap=randomGap();
}
function spawnBird(){
    let y;
    if(Math.random()<0.6){
        y=Math.random()<0.5?200:170;
    }else{ y=130+Math.random()*20; }
    obstacles.push({type:"bird",x:canvas.width,y:y,width:30,height:20});
    nextObstacleGap=randomGap();
}
function updateObstacles(){
    obstacles.forEach(o=>o.x-=obstacleSpeed);
    obstacles=obstacles.filter(o=>o.x>-o.width);
    if(obstacles.length===0){ spawnCactus(); return; }
    let last=obstacles[obstacles.length-1];
    if(canvas.width-last.x>=nextObstacleGap){
        if(score<5000){ spawnCactus(); }
        else{ Math.random()<0.25?spawnBird():spawnCactus(); }
    }
}

// ===== COLLISION =====
function checkCollision(){
    obstacles.forEach(o=>{
        let h=dino.ducked?20:dino.height;
        let y=dino.ducked?dino.y+20:dino.y;
        if(dino.x<o.x+o.width && dino.x+dino.width>o.x && y<o.y+o.height && y+h>o.y){
            gameRunning=false;
            gameOver=true;
            gameOverSound.currentTime=0;
            gameOverSound.play();
            gameOverDiv.style.display="block";
        }
    });
}

// ===== GAME LOOP =====
function gameLoop(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground();
    drawDino();
    drawObstacles();
    updateDino();
    updateObstacles();
    checkCollision();
    score+=1.5;
    if(score>highScore){
        highScore=Math.floor(score);
        localStorage.setItem("highScore",highScore);
        if(!recordPlayed){
            newRecordSound.currentTime=0;
            newRecordSound.play();
            recordPlayed=true;
        }
    }
    scoreDiv.textContent=`Äiá»ƒm: ${Math.floor(score)} | Ká»‰ lá»¥c: ${highScore}`;
    requestAnimationFrame(gameLoop);
}

// ===== COUNTDOWN =====
function startCountdown(){
    let c=3;
    countdownDiv.style.display="block";
    countdownDiv.textContent=c;
    const t=setInterval(()=>{
        c--;
        if(c>0) countdownDiv.textContent=c;
        else{
            clearInterval(t);
            countdownDiv.style.display="none";
            gameRunning=true;
            gameLoop();
        }
    },1000);
}

// ===== RESET =====
function resetGame(){
    obstacles=[];
    score=0;
    recordPlayed=false;
    dino.y=220; dino.dy=0; dino.jumping=false; dino.ducked=false;
    gameOver=false;
    gameOverDiv.style.display="none";
    startCountdown();
}

// ===== EVENTS =====
startButton.onclick=()=>{
    startButton.style.display="none";
    resetGame();
};
document.addEventListener("keydown",e=>{
    if(e.code==="Space"){
        e.preventDefault();
        if(gameRunning&&!dino.jumping&&!dino.ducked){
            dino.jumping=true; dino.dy=-14;
            jumpSound.currentTime=0; jumpSound.play();
        }else if(gameOver){ resetGame(); }
    }
    if(e.code==="ArrowDown"&&gameRunning&&!dino.jumping) dino.ducked=true;
});
document.addEventListener("keyup",e=>{ if(e.code==="ArrowDown") dino.ducked=false; });

// ===== TOUCH CONTROLS =====
jumpBtn.addEventListener("touchstart", e=>{
    e.preventDefault();
    if(gameRunning&&!dino.jumping&&!dino.ducked){
        dino.jumping=true; dino.dy=-14;
        jumpSound.currentTime=0; jumpSound.play();
    }else if(gameOver){ resetGame(); }
});
duckBtn.addEventListener("touchstart", e=>{
    e.preventDefault();
    if(gameRunning&&!dino.jumping) dino.ducked=true;
});
duckBtn.addEventListener("touchend", e=>{ dino.ducked=false; });

</script>
</body>
</html>
