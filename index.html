<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ĐỒ ÁN TỐT NGHIỆP SỚM CỦA ANH CU TÂN</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-family:Arial,sans-serif;
    background:url('anhnen.jpg') no-repeat center center;
    background-size:cover;
}
canvas{ border:2px solid black; }
#startButton{
    padding:10px 20px;
    font-size:18px;
    cursor:pointer;
}
#score{ font-size:22px; margin:5px; }
#countdown{ font-size:48px; color:blue; display:none; }
#gameOver{ font-size:24px; color:red; display:none; }
</style>
</head>

<body>

<h2 style="color:darkblue;">ĐỒ ÁN TỐT NGHIỆP SỚM CỦA ANH CU TÂN</h2>
<button id="startButton">Bắt đầu</button>
<div id="countdown"></div>
<div id="score">Điểm: 0 | Kỉ lục: 0</div>
<div id="gameOver">Game Over! Nhấn Space để chơi lại</div>

<canvas id="gameCanvas" width="1200" height="300"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const startButton = document.getElementById("startButton");
const scoreDiv = document.getElementById("score");
const countdownDiv = document.getElementById("countdown");
const gameOverDiv = document.getElementById("gameOver");

// ===== IMAGES =====
const groundImg = new Image(); groundImg.src="dat.jpg";
const dinoImg = new Image(); dinoImg.src="khunglong.jpg";
const cactusImg = new Image(); cactusImg.src="xuongrong.jpg";
const birdImg = new Image(); birdImg.src="chim.jpg";

// ===== SOUNDS =====
const jumpSound = new Audio("jump.mp3");
const gameOverSound = new Audio("gameover.mp3");
const newRecordSound = new Audio("newrecord.mp3");

// ===== VARIABLES =====
let bgX=0;
let dino={x:50,y:220,width:40,height:40,dy:0,jumping:false,ducked:false};
let obstacles=[];
let score=0;
let gameRunning=false;
let gameOver=false;

let gravity=0.8;
let jumpStrength=-14;
let obstacleSpeed=5;

let highScore = localStorage.getItem("highScore") || 0;
let recordPlayed = false;

// ===== DRAW =====
function drawBackground(){
    ctx.drawImage(groundImg,-bgX,0,canvas.width,canvas.height);
    ctx.drawImage(groundImg,canvas.width-bgX,0,canvas.width,canvas.height);
    bgX+=1;
    if(bgX>=canvas.width) bgX=0;
}
function drawDino(){
    ctx.drawImage(dinoImg,dino.x,dino.y,dino.width*1.5,dino.height*1.5);
}
function drawObstacles(){
    obstacles.forEach(o=>{
        if(o.type==="cactus")
            ctx.drawImage(cactusImg,o.x,o.y,o.width*1.5,o.height*1.5);
        else
            ctx.drawImage(birdImg,o.x,o.y,o.width,o.height);
    });
}

// ===== UPDATE =====
function updateDino(){
    if(dino.jumping){
        dino.dy+=gravity;
        dino.y+=dino.dy;
        if(dino.y>=220){
            dino.y=220;
            dino.dy=0;
            dino.jumping=false;
        }
    }
}

function spawnCactus(){
    obstacles.push({type:"cactus",x:canvas.width,y:220,width:20,height:40});
}

function updateObstacles(){
    obstacles.forEach(o=>o.x-=obstacleSpeed);
    obstacles = obstacles.filter(o=>o.x>-50);
    if(obstacles.length===0 || canvas.width-obstacles[obstacles.length-1].x>300){
        spawnCactus();
    }
}

function checkCollision(){
    obstacles.forEach(o=>{
        if(dino.x<o.x+o.width &&
           dino.x+dino.width>o.x &&
           dino.y<o.y+o.height &&
           dino.y+dino.height>o.y){
            gameRunning=false;
            gameOver=true;
            gameOverSound.currentTime=0;
            gameOverSound.play();
            gameOverDiv.style.display="block";
        }
    });
}

// ===== GAME LOOP =====
function gameLoop(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawBackground();
    drawDino();
    drawObstacles();
    updateDino();
    updateObstacles();
    checkCollision();

    score+=1.5;

    if(score>highScore){
        highScore=Math.floor(score);
        localStorage.setItem("highScore",highScore);
        if(!recordPlayed){
            newRecordSound.currentTime=0;
            newRecordSound.play();
            recordPlayed=true;
        }
    }

    scoreDiv.textContent=
    "Điểm: "+Math.floor(score)+" | Kỉ lục: "+highScore;

    requestAnimationFrame(gameLoop);
}

// ===== COUNTDOWN =====
function startCountdown(){
    let c=3;
    countdownDiv.style.display="block";
    countdownDiv.textContent=c;
    const t=setInterval(()=>{
        c--;
        if(c>0) countdownDiv.textContent=c;
        else{
            clearInterval(t);
            countdownDiv.style.display="none";
            gameRunning=true;
            gameLoop();
        }
    },1000);
}

// ===== RESET =====
function resetGame(){
    obstacles=[];
    score=0;
    recordPlayed=false;
    dino.y=220; dino.dy=0; dino.jumping=false;
    gameOver=false;
    gameOverDiv.style.display="none";
    startCountdown();
}

// ===== EVENTS =====
startButton.onclick=()=>{
    startButton.style.display="none";
    resetGame();
};

document.addEventListener("keydown",e=>{
    if(e.code==="Space"){
        e.preventDefault();
        if(gameRunning && !dino.jumping){
            dino.jumping=true;
            dino.dy=jumpStrength;
            jumpSound.currentTime=0;
            jumpSound.play();
        }else if(gameOver){
            resetGame();
        }
    }
});
</script>

</body>
</html>
