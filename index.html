<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Khủng Long Cổ Điển</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #000;
            background-color: #fff;
        }
        #startButton {
            margin: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
        #score {
            font-size: 24px;
            margin: 10px;
        }
        #gameOver {
            font-size: 24px;
            color: red;
            margin: 10px;
        }
        #countdown {
            font-size: 48px;
            color: blue;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Game Khủng Long Cổ Điển</h1>
    <button id="startButton">Bắt đầu</button>
    <div id="countdown" style="display: none;"></div>
    <div id="score">Điểm: 0</div>
    <div id="gameOver" style="display: none;">Game Over! Nhấn Space để chơi lại.</div>
    <canvas id="gameCanvas" width="800" height="200"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const scoreDiv = document.getElementById('score');
        const gameOverDiv = document.getElementById('gameOver');
        const countdownDiv = document.getElementById('countdown');

        let dino = { x: 50, y: 150, width: 40, height: 40, dy: 0, jumping: false, ducked: false };
        let obstacles = [];
        let score = 0;
        let gameRunning = false;
        let gameOver = false;
        let obstacleSpeed = 5;
        let maxSpeed = 10; // Tốc độ tối đa
        let speedIncreaseCounter = 0; // Bộ đếm để tăng tốc độ
        let gravity = 0.6;
        let jumpStrength = -12;
        let lastCactusX = -1000; // Vị trí x của cây xương rồng cuối cùng
        let birdSpawnTimer = 0; // Bộ đếm thời gian để spawn chim
        let nextBirdSpawn = 300 + Math.random() * 180; // Thời gian spawn chim tiếp theo (300-480 frame, khoảng 5-8 giây ở 60fps)

        // Vẽ khủng long
        function drawDino() {
            ctx.fillStyle = 'green';
            let drawHeight = dino.height;
            let drawY = dino.y;
            if (dino.ducked) {
                drawHeight = 20; // Giảm chiều cao khi cúi
                drawY = dino.y + 20;
            }
            ctx.fillRect(dino.x, drawY, dino.width, drawHeight);
        }

        // Vẽ chướng ngại vật
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                if (obstacle.type === 'cactus') {
                    ctx.fillStyle = 'red';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                } else if (obstacle.type === 'bird') {
                    ctx.fillStyle = 'blue';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                }
            });
        }

        // Cập nhật vị trí khủng long
        function updateDino() {
            if (dino.jumping) {
                dino.dy += gravity;
                dino.y += dino.dy;
                if (dino.y >= 150) {
                    dino.y = 150;
                    dino.dy = 0;
                    dino.jumping = false;
                }
            }
        }

        // Cập nhật chướng ngại vật
        function updateObstacles() {
            obstacles.forEach(obstacle => {
                obstacle.x -= obstacleSpeed;
            });
            obstacles = obstacles.filter(obstacle => obstacle.x > -obstacle.width);

            // Thêm chướng ngại vật mới
            let canSpawn = false;
            let type = 'cactus'; // Mặc định là cactus
            if (obstacles.length === 0) {
                canSpawn = true;
            } else {
                let lastObstacle = obstacles[obstacles.length - 1];
                let minDistance = 150; // Khoảng cách tối thiểu chung
                if (lastObstacle.x < canvas.width - minDistance) {
                    canSpawn = true;
                }
            }

            if (canSpawn) {
                let newObstacle;
                // Spawn cactus với khoảng cách ngẫu nhiên ngắn hơn để tăng số lượng
                let cactusMinDistance = 150 + Math.random() * 200; // Ngẫu nhiên từ 150-350 pixel (giảm so với trước)
                if (canvas.width - lastCactusX >= cactusMinDistance) {
                    newObstacle = { x: canvas.width, y: 150, width: 20, height: 40, type: 'cactus' };
                    lastCactusX = canvas.width;
                }
                // Spawn chim nếu đủ điều kiện
                birdSpawnTimer++;
                if (birdSpawnTimer >= nextBirdSpawn && Math.floor(score / 10) >= 1000) { // Chim chỉ xuất hiện khi điểm >= 1000
                    newObstacle = { x: canvas.width, y: 140 + Math.random() * 30, width: 30, height: 20, type: 'bird' };
                    birdSpawnTimer = 0;
                    nextBirdSpawn = 300 + Math.random() * 180; // Reset timer cho chim tiếp theo
                }
                if (newObstacle) {
                    obstacles.push(newObstacle);
                }
            }
        }

        // Kiểm tra va chạm
        function checkCollision() {
            obstacles.forEach(obstacle => {
                let dinoHeight = dino.ducked ? 20 : dino.height;
                let dinoY = dino.ducked ? dino.y + 20 : dino.y;
                if (dino.x < obstacle.x + obstacle.width &&
                    dino.x + dino.width > obstacle.x &&
                    dinoY < obstacle.y + obstacle.height &&
                    dinoY + dinoHeight > obstacle.y) {
                    gameOver = true;
                    gameRunning = false;
                    gameOverDiv.style.display = 'block';
                }
            });
        }

        // Vẽ nền
        function drawGround() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 190, canvas.width, 10);
        }

        // Game loop
        function gameLoop() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGround();
            drawDino();
            drawObstacles();
            updateDino();
            updateObstacles();
            checkCollision();
            score++;
            scoreDiv.textContent = `Điểm: ${Math.floor(score / 10)}`;

            // Tăng tốc độ dần dần
            speedIncreaseCounter++;
            if (speedIncreaseCounter >= 60 && obstacleSpeed < maxSpeed) { // Mỗi 60 frame (khoảng 1 giây ở 60fps), tăng tốc nếu chưa đạt max
                obstacleSpeed += 0.1;
                speedIncreaseCounter = 0;
            }

            requestAnimationFrame(gameLoop);
        }

        // Đếm ngược
        function startCountdown() {
            let count = 3;
            countdownDiv.style.display = 'block';
            countdownDiv.textContent = count;
            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownDiv.textContent = count;
                } else {
                    clearInterval(interval);
                    countdownDiv.style.display = 'none';
                    gameRunning = true;
                    gameLoop();
                }
            }, 1000);
        }

        // Bắt đầu game
        startButton.addEventListener('click', () => {
            startButton.style.display = 'none';
            gameOverDiv.style.display = 'none';
            dino.y = 150;
            dino.dy = 0;
            dino.jumping = false;
            dino.ducked = false;
            obstacles = [];
            score = 0;
            gameOver = false;
            obstacleSpeed = 5; // Reset tốc độ
            speedIncreaseCounter = 0; // Reset bộ đếm
            lastCactusX = -1000; // Reset vị trí xương rồng
            birdSpawnTimer = 0; // Reset timer chim
            nextBirdSpawn = 300 + Math.random() * 180; // Reset timer chim
            startCountdown();
        });

        // Sự kiện nhấn phím
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameRunning && !dino.jumping && !dino.ducked) {
                    // Nhảy nếu game đang chạy
                    dino.jumping = true;
                    dino.dy = jumpStrength;
                } else if (gameOver) {
                    // Chơi lại
                    startButton.style.display = 'none';
                    gameOverDiv.style.display = 'none';
                    dino.y = 150;
                    dino.dy = 0;
                    dino.jumping = false;
                    dino.ducked = false;
                    obstacles = [];
                    score = 0;
                    gameOver = false;
                    obstacleSpeed = 5; // Reset tốc độ
                    speedIncreaseCounter = 0; // Reset bộ đếm
                    lastCactusX = -1000; // Reset vị trí xương rồng
                    birdSpawnTimer = 0; // Reset timer chim
                    nextBirdSpawn = 300 + Math.random() * 180; // Reset timer chim
                    startCountdown();
                }
            } else if (e.code === 'ArrowDown') {
                e.preventDefault();
                if (gameRunning && !dino.jumping) {
                    dino.ducked = true;
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowDown') {
                dino.ducked = false;
            }
        });
    </script>
</body>
</html>
